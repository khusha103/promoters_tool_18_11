<ion-header [translucent]="true" class="custom-border-header">
  <ion-toolbar class="maincontainer">
    <ion-grid>
      <ion-row class="toolbar-row">
        <ion-col size="4" class="toolbar-col">
          <a href="#" class="back_link">
            <ion-icon name="chevron-back-outline" class="back-button" [routerLink]="['/promoters-assessment']"></ion-icon>
          </a>
        </ion-col>
        <ion-col size="4" class="toolbar-col second_col_img">
          <img src="/assets/icon/homeicons/sony_light.svg" alt="" class="SONY_mail_logo dark_pta">
          <img src="/assets/icon/homeicons/sony_dark.svg" alt="" class="SONY_mail_logo light_pta"> </ion-col>
        <ion-col size="4" class="toolbar-col"></ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content class="main-content dark light">
  <!-- Sticky banner for unanswered items -->
<div *ngIf="hasTriedSubmit && unansweredCount > 0" class="unanswered-banner">
  {{ unansweredCount }} question(s) need an answer. Please complete them.
</div>
<div *ngFor="let question of questions; let i = index"
     class="question-card margin-bottom-20"
     [ngClass]="{'unanswered': hasTriedSubmit && isUnanswered(question)}"
     #qRef>

    <h6 class="questionhead">Question {{ i + 1 }}:</h6>
    <!-- Display question body -->
    <p class="question-body questionpara">{{ question.body }}</p>
    <!-- Display image if file_name is not null -->
    <!-- <img *ngIf="question.file_name" [src]="baseUrl + question.file_name" alt="Question Image" class="question-image" /> -->
    <img *ngIf="question.file_name" [src]="baseUrl + question.file_name" alt="Question Image" class="question-image"
      (click)="openImageInBrowser(baseUrl + question.file_name)" />


 
<div class="options margin-top-10">
  <ion-label class="options">Options:</ion-label>

  <!-- Percentage / 1..5 type -->
  <ion-radio-group
    [(ngModel)]="question.selectedOption"
    (ngModelChange)="onOptionChange(question, $event)"
    *ngIf="(question.type_id === '2' || question.type_id === 2) && question.option_type !== '4'">
    
    <ion-item class="transparent-item">
      <ion-label class="low-percentage">&lt;60%</ion-label>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>1</ion-label>
      <ion-radio [value]="1"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>2</ion-label>
      <ion-radio [value]="2"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>3</ion-label>
      <ion-radio [value]="3"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>4</ion-label>
      <ion-radio [value]="7"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>5</ion-label>
      <ion-radio [value]="8"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label class="high-percentage">&gt;90%</ion-label>
    </ion-item>
  </ion-radio-group>

  <!-- Yes/No/NA type -->
  <ion-radio-group
    [(ngModel)]="question.selectedOption"
    (ngModelChange)="onOptionChange(question, $event)"
    *ngIf="(question.type_id === '1' || question.type_id === 1) && question.option_type !== '4'">
    
    <ion-item class="transparent-item" *ngIf="question.is_na === '1' || question.is_na === 1">
      <ion-label>NA</ion-label>
      <ion-radio [value]="4"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>Yes</ion-label>
      <ion-radio [value]="5"></ion-radio>
    </ion-item>

    <ion-item class="transparent-item">
      <ion-label>No</ion-label>
      <ion-radio [value]="6"></ion-radio>
    </ion-item>
  </ion-radio-group>

  <!-- Rating (Very Bad -> Very Good) when option_type === '4' -->
<ng-container *ngIf="question.option_type === '4' || question.type_id === '4'">
  <ion-radio-group [(ngModel)]="question.selectedOption" (ngModelChange)="onOptionChange(question, $event)">
    <ng-container *ngFor="let r of question.ratingOptions">
      <ion-item lines="none" class="match-radio-item" [class.checked]="question.selectedOption === r.id">
        <ion-label class="match-radio-label">
          <div class="match-title">{{ r.label }}</div>
          <div class="match-desc" *ngIf="r.description">{{ r.description }}</div>
        </ion-label>
        <ion-radio slot="end" [value]="r.id"></ion-radio>
      </ion-item>
    </ng-container>
  </ion-radio-group>
</ng-container>
</div>



    <!-- Remarks input field -->
    <!-- <div class="remarks margin-top-10">
      <ion-label>Remarks:</ion-label>
      <ion-input type="text" placeholder="Enter Remark" [(ngModel)]="question.remarks"
        class="white-background"></ion-input>

        <ion-button class="upload-button" fill="clear" (click)="selectImage(i)">
          <ion-icon name="camera-outline"></ion-icon>
        </ion-button>
    </div> -->

    <div class="remarks-upload-container">
      <ion-label class="options">Remarks:</ion-label>
      <ion-input type="text" placeholder="Enter Remark" [(ngModel)]="question.remarks" class="options"></ion-input>

      <!-- Upload Image Button -->
      <ion-button class="upload-button" fill="clear" (click)="selectImage(i)">
        <ion-icon name="camera-outline"></ion-icon>
      </ion-button>
    </div>

    <!-- Uploaded Images Preview -->
<div class="image-preview-container" *ngIf="photos[i] && photos[i].length > 0">
  <div *ngFor="let photo of photos[i]" class="image-thumbnail">
    <img [src]="photo.base64" alt="Captured Image">
  </div>
</div>

    <hr />
  </div>

  <!-- <ion-textarea
    [(ngModel)]="feedback"
    placeholder="Enter your feedback here..."
    maxlength="500"
    fill="outline"
    label-placement="stacked"
  ></ion-textarea> -->

<!-- Textarea with an icon INSIDE the box -->
<div class="feedback-input-wrap">
  <ion-textarea [(ngModel)]="feedback"
                placeholder="Enter your feedback here..."
                maxlength="500"
                fill="outline"
                label-placement="stacked"
                class="custom-textarea cttextareas with-icon">
  </ion-textarea>

  <!-- same handler, now positioned inside -->
  <ion-icon name="camera-outline"
            class="feedback-camera inside"
            (click)="selectFeedbackImage()">
  </ion-icon>
</div>

<!-- Feedback Images Preview (optional) -->
<div class="image-preview-container" *ngIf="feedbackPhotos.length > 0">
  <div *ngFor="let photo of feedbackPhotos" class="image-thumbnail">
    <img [src]="photo.base64" alt="Feedback Image">
  </div>
</div>



  <!-- Submit Button -->
  <div class="submit-button">
    <!-- <ion-button expand="full" (click)="submitAnswers()" [disabled]="!areAllQuestionsAnswered()">Submit
      Answers</ion-button> -->

<ion-button expand="full" (click)="confirmAndSubmit()" class="products_buttons">Submit
  Answers</ion-button>
  </div>

  <!-- <ion-button class="back-button-bottom-right" color="dark" (click)="showExitConfirmationQues()">
    <ion-icon name="chevron-back-outline"></ion-icon>
  </ion-button> -->

</ion-content>

<!-- Optional footer component -->
<app-footer></app-footer>