<ion-header [translucent]="true" class="custom-border-header">
  <ion-toolbar class="maincontainer">
    <ion-grid>
      <ion-row class="toolbar-row">
        <ion-col size="4" class="toolbar-col">
          <a href="#" class="back_link">
            <ion-icon name="chevron-back-outline" class="back-button" [routerLink]="['/promoter-kpi']"></ion-icon>
          </a>
        </ion-col>
        <ion-col size="4" class="toolbar-col second_col_img">
          <img src="/assets/icon/homeicons/sony_light.svg" alt="" class="SONY_mail_logo dark_pta">
          <img src="/assets/icon/homeicons/sony_dark.svg" alt="" class="SONY_mail_logo light_pta">
        </ion-col>
        <ion-col size="4" class="toolbar-col"></ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content class="main-content padding-20 dark light">
  <div class="heading-div">
    <h6 class="home-headings">Questions</h6>
  </div>
    <!-- sticky unanswered banner (promoter style) -->
  <div *ngIf="hasTriedSubmit && unansweredCount > 0" class="unanswered-banner">
    {{ unansweredCount }} question(s) need an answer. Please complete them.
  </div>


  <div class="question-container">
<div #questionCard *ngFor="let question of questions; let i = index; trackBy: trackByQuestion"
     class="question-card"
     [ngClass]="{'unanswered': hasTriedSubmit && (question.selectedOption === null || question.selectedOption === undefined)}">

      <h6 class="questionhead">Question {{ i + 1 }}:</h6>
      <p class="questionpara">{{ question.body }}</p>

      <img *ngIf="question.file_name"
           [src]="question.file_name"
           class="question-image"
           (click)="openImageInBrowser(question.file_name)" />

      <div class="options">
       <ion-radio-group [(ngModel)]="question.selectedOption">
  <ion-item class="transparent-item" lines="none">
    <ion-label>Yes</ion-label>
    <ion-radio slot="start" [value]="5"></ion-radio>
  </ion-item>
  <ion-item class="transparent-item" lines="none">
    <ion-label>No</ion-label>
    <ion-radio slot="start" [value]="6"></ion-radio>
  </ion-item>
  <ion-item *ngIf="question.is_na === '1'" class="transparent-item" lines="none">
    <ion-label>NA</ion-label>
    <ion-radio slot="start" [value]="4"></ion-radio>
  </ion-item>
      </ion-radio-group>

<ng-container *ngIf="question.option_type === '4' || question.type_id === '4'">
  <ion-radio-group [(ngModel)]="question.selectedOption"
                   (ngModelChange)="onOptionChange(question, $event)">
    
    <div class="rating-option-column">

      <div *ngFor="let r of question.ratingOptions"
           class="rating-option-row"
           [attr.aria-checked]="question.selectedOption === r.id ? 'true' : 'false'">

        <!-- RADIO BUTTON -->
        <div class="rating-radio-cell">
          <ion-radio class="rating-radio" [value]="r.id"></ion-radio>
        </div>

        <!-- LABEL + DESCRIPTION -->
        <div class="rating-text-cell">
          <div class="rating-title">{{ r.label }}</div>
          <div class="rating-description" *ngIf="r.description">{{ r.description }}</div>
        </div>

      </div>
    </div>

  </ion-radio-group>
</ng-container>
      </div>

      <div class="remarks-upload-container">
        <ion-label class="remarks">Remarks:</ion-label>
        <ion-input type="text" placeholder="Enter Remark"
                   [(ngModel)]="question.remarks" class="ionremarks"></ion-input>

        <ion-button class="upload-button camerabutton" fill="clear" (click)="selectImage(i)">
          <ion-icon name="camera-outline" class="orange" style="color:#e66b24 !important;"></ion-icon>
        </ion-button>
      </div>

      <!-- Multiple images per question -->
      <div class="image-preview-container" *ngIf="photos[i]?.length">
        <div *ngFor="let photo of photos[i]; let j = index" class="image-thumbnail">
          <img [src]="photo.base64" alt="Captured Image">
          <ion-icon name="close-circle" class="delete-icon" (click)="removeQuestionImage(i, j)"></ion-icon>
        </div>
      </div>
    </div>

    <ion-textarea [(ngModel)]="feedback"
                  placeholder="Enter your Questionnaire feedback here..."
                  maxlength="500"
                  fill="outline"
                  label-placement="stacked"
                  class="custom-textarea">
    </ion-textarea>

    <hr>

    <!-- Feedback sections (optional, multi-images) -->
    <div class="feedback-card" *ngFor="let feedbackItem of feedbackImages; let idx = index">
      <div class="textarea-container">
        <ion-textarea [(ngModel)]="feedbackItem.caption"
                      placeholder="Enter feedback..."
                      autoGrow="true"
                      class="feedback-textarea"></ion-textarea>

        <ion-icon name="close" class="remove-icon" (click)="removeFeedbackSection(idx)"></ion-icon>
        <ion-icon name="camera-outline" class="camera-icon" (click)="selectFeedbackImage(idx)"></ion-icon>
      </div>

      <div class="feedback-preview-multi" *ngIf="feedbackItem.images.length">
        <div class="image-thumbnail" *ngFor="let img of feedbackItem.images; let k = index">
          <img [src]="img" alt="Feedback Image" />
          <ion-icon name="close-circle" class="delete-icon" (click)="removeFeedbackImage(idx, k)"></ion-icon>
        </div>
      </div>
    </div>

    <div class="add-feedback-btn">
      <ion-button expand="full" (click)="addFeedbackSection()" class="products_buttons">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Add Feedback
      </ion-button>
    </div>

    <div class="submit-button">
      <ion-button expand="full" (click)="onSubmitClick()" class="products_buttons">
        Submit Answers
      </ion-button>
    </div>
  </div>
</ion-content>

<app-footer></app-footer>
