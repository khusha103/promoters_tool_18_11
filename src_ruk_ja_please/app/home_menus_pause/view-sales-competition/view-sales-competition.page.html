<ion-header [translucent]="true" class="custom-border-header">
  <ion-toolbar class="maincontainer">
    <ion-grid class="extra_head-height">
      <ion-row class="toolbar-row">
        <ion-col size="4" class="toolbar-col">
          <a href="#" class="back_link">
            <!-- <ion-icon name="chevron-back-outline" class="back-button" [routerLink]="['/daily-sales']"></ion-icon> -->
          </a>
        </ion-col>
        <ion-col size="4" class="toolbar-col second_col_img">
          <img src="\assets\icon\homeicons\sony_light.svg" alt="" class="SONY_mail_logo dark_pta">
          <img src="\assets\icon\homeicons\sony_dark.svg" alt="" class="SONY_mail_logo light_pta"> 
        </ion-col>
        <ion-col size="4" class="toolbar-col">
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content class="main-content dark light">

  <div class="heading-div">
    <h6 class="home-headings">Sales View Competition</h6>
  </div>
  <div class="salesshow_div" *ngIf="userRole == 3">
    <ion-grid>
      <ion-row>
        <ion-col size="6" class="dailysales_all_cols" id="dailysales_all_cols_id">
          <ion-label position="stacked" class="labels">From Date:</ion-label>
          <ion-item class="custom-input-item" lines="none">
            <p id="from-date-trigger" class="custom-select fieldss">
              <ion-icon name="calendar" class="calender-icon"></ion-icon>
              Date: {{selectedFromDate | date:'dd-MM-yyyy' || '__________'}}
            </p>
          </ion-item>
          <ion-popover #fromPopover trigger="from-date-trigger" [isOpen]="isFromPopoverOpen"
            (ionPopoverDidDismiss)="isFromPopoverOpen = false">
            <ng-template>
              <ion-content class="popover-content">
                <ion-datetime presentation="date" (ionChange)="onFromDateChange($event)"
                  (ionCancel)="fromPopover.dismiss()" class="mine-calender">
                </ion-datetime>
              </ion-content>
            </ng-template>
          </ion-popover>
        </ion-col>

        <!-- To Date Picker -->
        <ion-col size="6" class="dailysales_all_cols" id="dailysales_all_cols_id">
          <ion-label position="stacked" class="labels">To Date:</ion-label>
          <ion-item class="custom-input-item" lines="none">
            <p id="to-date-trigger" class="custom-select fieldss">
              <ion-icon name="calendar" class="calender-icon"></ion-icon>
              Date: {{selectedToDate | date:'dd-MM-yyyy' || '__________'}}
            </p>
          </ion-item>
          <ion-popover #toPopover trigger="to-date-trigger" [isOpen]="isToPopoverOpen"
            (ionPopoverDidDismiss)="isToPopoverOpen = false">
            <ng-template>
              <ion-content class="popover-content">
                <ion-datetime presentation="date" (ionChange)="onToDateChange($event)" (ionCancel)="toPopover.dismiss()"
                  class="mine-calender">
                </ion-datetime>
              </ion-content>
            </ng-template>
          </ion-popover>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Category</ion-label>
            <ion-select placeholder="Select Category" class="custom-select fieldss" [(ngModel)]="selectedCategory"
              (ionChange)="onCategoryChange(selectedCategory?.id)" [interfaceOptions]="categoryOptions">
              <ion-select-option *ngFor="let category of categories" [value]="category">{{ category.category_name
                }}</ion-select-option>
            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size="6" class="dailysales_all_cols">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Brand</ion-label>

            <ion-select placeholder="Select Brand" class="custom-select fieldss" [(ngModel)]="selectedBrands"
              [interfaceOptions]="brandsOptions" multiple="true" (ionChange)="onBrandChange($event)">
              <ion-select-option *ngFor="let brand of brands" [value]="brand.brand">
                {{ brand.brand }}
              </ion-select-option>
            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>



      </ion-row>

    </ion-grid>
  </div>

  <div class="salesshow_div" *ngIf="userRole != 3">
    <ion-grid>
      <ion-row>
        <ion-col size="6" class="dailysales_all_cols" id="dailysales_all_cols_id">
          <ion-label position="stacked" class="labels">From Date:</ion-label>
          <ion-item class="custom-input-item" lines="none">
            <p id="from-date-trigger" class="custom-select fieldss">
              <ion-icon name="calendar" class="calender-icon"></ion-icon>
              Date: {{selectedFromDate | date:'dd-MM-yyyy' || '__________'}}
            </p>
          </ion-item>
          <ion-popover #fromPopover trigger="from-date-trigger" [isOpen]="isFromPopoverOpen"
            (ionPopoverDidDismiss)="isFromPopoverOpen = false">
            <ng-template>
              <ion-content class="popover-content">
                <ion-datetime presentation="date" (ionChange)="onFromDateChange($event)"
                  (ionCancel)="fromPopover.dismiss()" class="mine-calender">
                </ion-datetime>
              </ion-content>
            </ng-template>
          </ion-popover>
        </ion-col>

        <!-- To Date Picker -->
        <ion-col size="6" class="dailysales_all_cols" id="dailysales_all_cols_id">
          <ion-label position="stacked" class="labels">To Date:</ion-label>
          <ion-item class="custom-input-item" lines="none">
            <p id="to-date-trigger" class="custom-select fieldss">
              <ion-icon name="calendar" class="calender-icon"></ion-icon>
              Date: {{selectedToDate | date:'dd-MM-yyyy' || '__________'}}
            </p>
          </ion-item>
          <ion-popover #toPopover trigger="to-date-trigger" [isOpen]="isToPopoverOpen"
            (ionPopoverDidDismiss)="isToPopoverOpen = false">
            <ng-template>
              <ion-content class="popover-content">
                <ion-datetime presentation="date" (ionChange)="onToDateChange($event)" (ionCancel)="toPopover.dismiss()"
                  class="mine-calender">
                </ion-datetime>
              </ion-content>
            </ng-template>
          </ion-popover>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Category</ion-label>
            <ion-select placeholder="Select Category" class="custom-select fieldss" [(ngModel)]="selectedCategory"
              (ionChange)="onCategoryChange(selectedCategory?.id)" [interfaceOptions]="categoryOptions">
              <ion-select-option *ngFor="let category of categories" [value]="category">{{ category.category_name
                }}</ion-select-option>
            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size="6" class="dailysales_all_cols">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Brand</ion-label>

            <ion-select placeholder="Select Brand" class="custom-select fieldss" [(ngModel)]="selectedBrands"
              (ionChange)="onBrandChange($event)" [interfaceOptions]="brandsOptions" multiple="true">
              <ion-select-option *ngFor="let brand of brands" [value]="brand.brand">
                {{ brand.brand }} <!-- Display the brand name -->
              </ion-select-option>
            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>

      </ion-row>
      <ion-row>

        <ion-col size="6">
          <ion-item class="custom-input-item" lines="none" id="mine">
            <ion-label position="stacked" class="labels">Country</ion-label>
            <ion-select placeholder="Select Country" [(ngModel)]="selectedCountry" (ionChange)="onCountryChange()"
              name="country" class="custom-select fieldss" [interfaceOptions]="countryOptions">

              <!-- Conditional rendering based on roleId -->
              <ng-container *ngIf="userRole == 4; else defaultCountries">
                <ion-select-option *ngFor="let country of pic_countries" [value]="country">
                  {{ country.name }}
                </ion-select-option>
              </ng-container>

              <ng-template #defaultCountries>
                <ion-select-option *ngFor="let country of countries" [value]="country">
                  {{ country.name }}
                </ion-select-option>
              </ng-template>

            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size="6">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Retailers</ion-label>
            <ion-select placeholder="Select Retailer" [(ngModel)]="selectedRetailer" (ionChange)="onRetailerChange()"
              name="retailer" [disabled]="!selectedCountry" class="custom-select fieldss"
              [interfaceOptions]="retailerOptions">
              <ion-select-option *ngFor="let retailer of retailers" [value]="retailer">
                {{ retailer.name }}
              </ion-select-option>
            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="6">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Stores</ion-label>
            <ion-select placeholder="Select Store" [(ngModel)]="selectedOutlet" name="outlet"
              [disabled]="!selectedRetailer" class="custom-select fieldss" [interfaceOptions]="storeOptions">
              <ion-select-option *ngFor="let outlet of outlets" [value]="outlet">
                {{ outlet.name }}
              </ion-select-option>
            </ion-select>
            <ion-icon name="chevron-down" class="select-icon down-arrow"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size="6">
          <ion-item class="custom-input-item" lines="none">
            <ion-label position="stacked" class="labels">Model</ion-label>
            <app-custom-product-dropdown [products]="products" (productSelected)="onProductSelected($event)">
            </app-custom-product-dropdown>
          </ion-item>
        </ion-col>

      </ion-row>
    </ion-grid>
  </div>


  <div class="checkbutton" *ngIf="userRole == 3">
    <ion-button expand="full_screen" class="products_buttons" size="default" (click)="loadCompSalesData()"
      [disabled]="!isPromoterFormValid()">
      <span class="spanbuttontext">View Sales</span>
    </ion-button>
    <ion-button expand="full_screen" class="products_buttons" size="default" id="download_sales"
      (click)="downloadSalesData()" [disabled]="!isPromoterFormValid() || isToDisabledownload">
      <!-- [disabled]="!isPromoterFormValid()"> -->
      <span class="spanbuttontext">Download Sales</span>
    </ion-button>
  </div>

  <div class="checkbutton" *ngIf="userRole == 14 || userRole == 4">
    <ion-button expand="full_screen" class="products_buttons" size="default" (click)="loadCompSalesData()"
      [disabled]="!isAdminFormValid()">
      <span class="spanbuttontext">View Sales</span>
    </ion-button>
    <ion-button expand="full_screen" class="products_buttons" size="default" id="download_sales"
      (click)="downloadSalesData()" [disabled]="!isAdminFormValid() || isToDisabledownload">
      <span class="spanbuttontext">Download Sales</span>
    </ion-button>
  </div>

  <div class="scrollable-table-container" *ngIf="compSalesData.length > 0">
    <table class="sales_data_table">
      <thead>
        <tr>
          <th class="sales_table_header">#</th> <!-- New column for entry number -->
          <th class="sales_table_header">Date</th>
          <th class="sales_table_header">Model</th>
          <th class="sales_table_header">Price</th>
          <th class="sales_table_header">Quantity</th>
          <th class="sales_table_header">Total</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of paginatedData; let i = index">
          <td class="sales_table_data">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
          <!-- Entry number calculation -->
          <td class="sales_table_data">{{ row.date }}</td>
          <td class="sales_table_data">{{ row.model }}</td>
          <td class="sales_table_data">{{ row.price }}</td>
          <td class="sales_table_data">{{ row.quantity }}</td>
          <td class="sales_table_data">{{ row.total }}</td>
        </tr>
      </tbody>
    </table>
    <!-- Display totals separately -->
    <div class="totals-container">
      <div><strong>Total Quantity:</strong> {{ compQuantityTotal || 0 }}</div>
      <div><strong>Total Amount:</strong> {{ compTotal || 0 }}</div>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-controls">
      <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
      Page {{ currentPage }} of {{ totalPages }}
      <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
    </div>

  </div>

  <!-- Message for no sales data -->
  <div *ngIf="errorMessage && compSalesData.length === 0">
    <p>{{ errorMessage }}</p>
  </div>

  <!-- <ion-button class="back-button-bottom-right" color="dark" [routerLink]="['/daily-sales']">
    <ion-icon name="chevron-back-outline"></ion-icon>
  </ion-button> -->

  

</ion-content>
<app-footer></app-footer>